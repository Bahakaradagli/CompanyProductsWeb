<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VELİOĞLU GLOBAL DIŞ TİCARET LİMİTED ŞİRKETİ – Markalar</title>

  <!-- fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- ortak stiller (varsa) -->
  <link rel="stylesheet" href="common.css">
  <!-- bu sayfanın stilleri -->
  <link rel="stylesheet" href="index.css">
</head>
<body>
  <!-- ==== DESKTOP NAV (KORUNDU) ==== -->
  <header class="desknav" role="banner" style="--accent:#54577D">
    <div class="desknav__wrap">
      <div class="desknav__inner">
        <!-- Sol: Logo + Başlık -->
        <div class="desknav__brand">
          <img class="desknav__logo"
               src="assets/logo-150.png"
               alt="VELİOĞLU GLOBAL DIŞ TİCARET LİMİTED ŞİRKETİ Logo"
               onerror="this.style.display='none'">
          <span class="desknav__title">VELİOĞLU GLOBAL DIŞ TİCARET LİMİTED ŞİRKETİ DAĞITIM</span>
        </div>

        <!-- Sağ: Sekmeler + Giriş/Ürün Ekle -->
        <nav class="desknav__tabs" aria-label="Ana gezinme">
          <a class="desknav__tab" href="index.html" aria-current="page">
            <span class="desknav__icon" aria-hidden="true">
              <svg viewBox="0 0 24 24"><path d="M10 6V5a2 2 0 0 1 2-2h0a2 2 0 0 1 2 2v1m-9 4h14m-15 0a2 2 0 0 1 2-2h11a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7Z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
            </span>
            <span>Markalar</span>
          </a>
          <a class="desknav__tab" href="products.html">
            <span class="desknav__icon" aria-hidden="true">
              <svg viewBox="0 0 24 24"><path d="M4 7h7v7H4V7Zm9 0h7v7h-7V7ZM8 17h8v3H8v-3Z" fill="currentColor"/></svg>
            </span>
            <span>Ürünler</span>
          </a>
          <a class="desknav__tab" href="contact.html">
            <span class="desknav__icon" aria-hidden="true">
              <svg viewBox="0 0 24 24"><path d="M3 10h18M5 10v8m4-8v8m6-8v8m4-8v8M3 18h18M12 4 3 8h18L12 4Z"
              fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
            </span>
            <span>İletişim</span>
          </a>

          <!-- EK: Giriş & Ürün Ekle -->
          <button id="addBtn" class="desknav__btn" style="display:none">Ürün Ekle</button>
          <button id="loginBtn" class="desknav__btn desknav__btn--ghost">Giriş</button>
        </nav>
      </div>
    </div>
  </header>

  <!-- ==== SAYFA İÇERİĞİ ==== -->
  <main class="container">
    <h2 class="page-title">Markalar</h2>
    <div id="brands" class="brands" aria-live="polite"></div>
  </main>

  <footer>
    <small>© <span id="y"></span> VELİOĞLU GLOBAL DIŞ TİCARET LİMİTED ŞİRKETİ • GitHub Pages</small>
  </footer>

  <!-- ===== MODALLAR ===== -->
  <!-- Giriş Modal -->
  <dialog id="loginModal" class="modal">
    <form method="dialog" class="modal__card" id="loginForm">
      <h3 class="modal__title">Giriş yap</h3>
      <div class="form__row">
        <label>Kullanıcı adı</label>
        <input type="text" name="user" placeholder="admin" required />
      </div>
      <div class="form__row">
        <label>Şifre</label>
        <input type="password" name="pass" placeholder="••••••••" required />
      </div>
      <div class="modal__actions">
        <button class="btn" value="cancel" type="button" id="loginCancel">İptal</button>
        <button class="btn btn--primary" type="submit">Giriş</button>
      </div>
      <p class="form__hint">Demo: <code>admin</code> / <code>veliogluGlobal34</code></p>
      <p class="form__error" id="loginError" hidden>Hatalı kullanıcı adı veya şifre.</p>
    </form>
  </dialog>

  <!-- Ürün Ekle Modal -->
  <dialog id="productModal" class="modal">
    <form method="dialog" class="modal__card" id="productForm">
      <h3 class="modal__title">Ürün Ekle</h3>

      <div class="grid2">
        <div class="form__row">
          <label>Ürün Adı</label>
          <input type="text" name="name" required />
        </div>
        <div class="form__row">
          <label>Marka</label>
          <input type="text" name="brand" placeholder="Doğuş" />
        </div>
        <div class="form__row">
          <label>Katalog (slug)</label>
          <input type="text" name="catalog" placeholder="dogus" required />
        </div>
        <div class="form__row">
          <label>Kategori</label>
          <input type="text" name="category" placeholder="Dökme Çay" />
        </div>
        <div class="form__row">
          <label>Paket</label>
          <input type="text" name="package" placeholder="500 g" />
        </div>
        <div class="form__row">
          <label>Koli Adedi</label>
          <input type="number" name="case_qty" placeholder="12" min="0" />
        </div>
        <div class="form__row grid2__span">
          <label>Görsel URL</label>
          <input type="url" name="img" placeholder="https://.../urun.png" />
        </div>
      </div>

      <div class="modal__actions">
        <button class="btn" value="cancel" type="button" id="productCancel">Vazgeç</button>
        <button class="btn btn--primary" type="submit">Kaydet</button>
      </div>

      <p class="form__error" id="productError" hidden>Kaydedilemedi. Lütfen tekrar deneyin.</p>
      <p class="form__success" id="productOk" hidden>Kaydedildi!</p>
    </form>
  </dialog>

  <!-- ===== SCRIPTS ===== -->
  <!-- aktif sekme emniyet -->
  <script>
    (function(){
      const here = (location.pathname.split('/').pop() || 'index.html');
      document.querySelectorAll('.desknav__tab').forEach(t=>{
        const isHere = (t.getAttribute('href')||'') === here || (here==='' && t.getAttribute('href')==='index.html');
        t.setAttribute('aria-current', isHere ? 'page' : 'false');
      });
    })();
  </script>

  <!-- JSON'dan Markalar -->
  <script>
    const $ = (s, r=document) => r.querySelector(s);

    async function loadJSON(url){
      const res = await fetch(url, { cache: 'no-store' });
      if(!res.ok) throw new Error(url + ' yüklenemedi');
      return res.json();
    }
    (async function initBrands(){
      try{
        const brands = await loadJSON('data/brands.json');
        const wrap = $('#brands');
        wrap.innerHTML = '';
        brands.forEach(b=>{
          const a = document.createElement('a');
          a.href = 'products.html#' + encodeURIComponent(b.id);
          a.className = 'brand';
          a.innerHTML = `
            <img src="${b.img}" alt="${b.name} logosu"
                 onerror="this.src='https://dummyimage.com/88x88/0b0d12/ffffff&text='+encodeURIComponent('${(b.name||'M')[0]}')">
            <div class="brand__text">
              <h4>${b.name}</h4>
              <small>${b.count ?? ''} ürün</small>
            </div>`;
          wrap.appendChild(a);
        });
        $('#y').textContent = new Date().getFullYear();
      }catch(e){
        console.error(e);
        alert('Markalar yüklenemedi.');
      }
    })();
  </script>

  <!-- Giriş & Ürün Ekle davranışı + Firebase (modüler SDK) -->
  <script type="module">
    // ==== Firebase ayarları ====
    // 1) Aşağıyı kendi projen ile doldur:
    //    https://console.firebase.google.com → Project settings → SDK setup
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // 2) SDK importları
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // 3) Başlat
    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    // ==== Login state (demo) ====
    const LOGIN_USER = "admin";
    const LOGIN_PASS = "veliogluGlobal34";
    const isAuthed   = () => localStorage.getItem("isAdmin") === "1";
    const setAuthed  = (v) => (v ? localStorage.setItem("isAdmin","1") : localStorage.removeItem("isAdmin"));

    const loginBtn   = document.getElementById("loginBtn");
    const addBtn     = document.getElementById("addBtn");
    const loginDlg   = document.getElementById("loginModal");
    const productDlg = document.getElementById("productModal");
    const loginForm  = document.getElementById("loginForm");
    const productForm= document.getElementById("productForm");

    function refreshAuthUI(){
      if(isAuthed()){
        addBtn.style.display = "";
        loginBtn.textContent = "Çıkış";
        loginBtn.classList.remove("desknav__btn--ghost");
      }else{
        addBtn.style.display = "none";
        loginBtn.textContent = "Giriş";
        loginBtn.classList.add("desknav__btn--ghost");
      }
    }
    refreshAuthUI();

    // Login / Logout
    loginBtn.addEventListener("click", ()=>{
      if(isAuthed()){ setAuthed(false); refreshAuthUI(); return; }
      loginDlg.showModal();
    });
    document.getElementById("loginCancel").addEventListener("click", ()=> loginDlg.close());

    loginForm.addEventListener("submit", (e)=>{
      e.preventDefault();
      const fd = new FormData(loginForm);
      const u = (fd.get("user")||"").trim();
      const p = (fd.get("pass")||"").trim();
      const err = document.getElementById("loginError");
      if(u === LOGIN_USER && p === LOGIN_PASS){
        setAuthed(true);
        err.hidden = true;
        loginDlg.close();
        refreshAuthUI();
      }else{
        err.hidden = false;
      }
    });

    // Ürün Ekle
    addBtn.addEventListener("click", ()=> productDlg.showModal());
    document.getElementById("productCancel").addEventListener("click", ()=> productDlg.close());

    productForm.addEventListener("submit", async (e)=>{
      e.preventDefault();
      if(!isAuthed()){ alert("Önce giriş yapın."); return; }

      const fd = new FormData(productForm);
      const product = {
        // Firestore'da id'yi otomatik oluşturacağız (addDoc)
        name: (fd.get("name")||"").trim(),
        brand: (fd.get("brand")||"").trim() || null,
        catalog: (fd.get("catalog")||"").trim(),
        category: (fd.get("category")||"").trim() || null,
        package: (fd.get("package")||"").trim() || null,
        case_qty: fd.get("case_qty") ? Number(fd.get("case_qty")) : null,
        img: (fd.get("img")||"").trim() || null,
        created_at: serverTimestamp()
      };

      const okEl = document.getElementById("productOk");
      const errEl= document.getElementById("productError");
      okEl.hidden = true; errEl.hidden = true;

      try{
        await addDoc(collection(db, "products"), product);
        okEl.hidden = false;
        productForm.reset();
        // modalı kısa gecikmeyle kapat
        setTimeout(()=>{ productDlg.close(); okEl.hidden = true; }, 600);
      }catch(err){
        console.error(err);
        errEl.hidden = false;
      }
    });

    // === NOT: Demo setini içeri almak istersen ===
    // aşağıdaki JSON’u (verdiğin Doğuş ürünleri) bir kerelik yüklemek için
    // aynı formüle göre tek tek ekleyebilirsin ya da ayrı bir "toplu yükleme"
    // modali ekleyebiliriz. İstersen onu da ekleyeyim.
  </script>
</body>
</html>