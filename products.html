<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Marmara DaÄŸÄ±tÄ±m â€“ ÃœrÃ¼nler</title>

  <!-- fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- stiller -->
  <link rel="stylesheet" href="common.css">
  <link rel="stylesheet" href="index.css"><!-- header iÃ§in -->
  <link rel="stylesheet" href="products.css">
</head>
<body>
  <!-- ==== DESKTOP NAV ==== -->
  <header class="desknav" role="banner" style="--accent:#54577D">
    <div class="desknav__wrap">
      <div class="desknav__inner">
        <div class="desknav__brand">
          <img class="desknav__logo" src="assets/logo-150.png" alt="Marmara DaÄŸÄ±tÄ±m Logo" onerror="this.style.display='none'">
          <span class="desknav__title">MARMARA DAÄžITIM</span>
        </div>
        <nav class="desknav__tabs" aria-label="Ana gezinme">
          <a class="desknav__tab" href="index.html">
            <span class="desknav__icon" aria-hidden="true">
              <svg viewBox="0 0 24 24"><path d="M10 6V5a2 2 0 0 1 2-2h0a2 2 0 0 1 2 2v1m-9 4h14m-15 0a2 2 0 0 1 2-2h11a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7Z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
            </span>
            <span>Markalar</span>
          </a>
          <a class="desknav__tab" href="products.html" aria-current="page">
            <span class="desknav__icon" aria-hidden="true">
              <svg viewBox="0 0 24 24"><path d="M4 7h7v7H4V7Zm9 0h7v7h-7V7ZM8 17h8v3H8v-3Z" fill="currentColor"/></svg>
            </span>
            <span>ÃœrÃ¼nler</span>
          </a>
          <a class="desknav__tab" href="contact.html">
            <span class="desknav__icon" aria-hidden="true">
              <svg viewBox="0 0 24 24"><path d="M3 10h18M5 10v8m4-8v8m6-8v8m4-8v8M3 18h18M12 4 3 8h18L12 4Z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
            </span>
            <span>Ä°letiÅŸim</span>
          </a>
        </nav>
      </div>
    </div>
  </header>

  <!-- ==== SAYFA Ä°Ã‡ERÄ°ÄžÄ° ==== -->
  <main class="container">
    <section class="products-head">
      <h2 class="products-title">ÃœrÃ¼nler</h2>

      <div class="products-toolbar" role="search">
        <label class="field select">
          <select id="catalogSelect" aria-label="Katalog seÃ§">
            <!-- JS ile doldurulacak -->
          </select>
        </label>

        <label class="field search" aria-label="ÃœrÃ¼n ara">
          <svg width="18" height="18" viewBox="0 0 20 20" fill="none" aria-hidden="true">
            <path d="M8.5 15.5a7 7 0 1 1 4.95-2.05l4.3 4.3-1.4 1.4-4.3-4.3A7 7 0 0 1 8.5 15.5Z" stroke="currentColor" stroke-width="1.5"/>
          </svg>
          <input id="searchInput" type="search" placeholder="Ara" autocomplete="off"/>
        </label>
      </div>
    </section>

    <section id="productGrid" class="products-grid" aria-live="polite" aria-busy="true"></section>

    <div id="emptyState" class="empty hidden" role="status">
      <div class="empty__icon" aria-hidden="true">ðŸ”Ž</div>
      <p class="empty__title">ÃœrÃ¼n bulunamadÄ±</p>
      <p class="empty__desc">Filtreleri deÄŸiÅŸtirip tekrar deneyin.</p>
    </div>
  </main>

  <footer>
    <small>Â© <span id="y"></span> Marmara DaÄŸÄ±tÄ±m â€¢ GitHub Pages</small>
  </footer>

  <!-- ==== JS ==== -->
  <script>
    const $ = s => document.querySelector(s);
    const $$ = s => [...document.querySelectorAll(s)];
    async function loadJSON(p){ const r=await fetch(p,{cache:'no-store'}); if(!r.ok) throw new Error(p); return r.json(); }

    let CATALOGS = [];
    let PRODUCTS = [];
    let currentCatalog = '';

    function fillCatalogSelect(){
      const sel = $('#catalogSelect');
      sel.innerHTML = CATALOGS.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
      // hash'ten gelen katalog varsa seÃ§
      const hash = (location.hash||'').replace('#','');
      if(hash && CATALOGS.some(c=>c.id===hash)){ sel.value = hash; currentCatalog = hash; }
      else { currentCatalog = sel.value; }
    }

    function productCard(p){
      const card = document.createElement('article');
      card.className = 'p-card';
      const catName = (CATALOGS.find(c=>c.id===p.catalog)||{}).name || '';
      card.innerHTML = `
        <div class="p-thumb">
          <img src="${p.img}" alt="${p.name}"
               onerror="this.src='https://dummyimage.com/600x600/0b0d12/ffffff&text='+encodeURIComponent('${p.name.substring(0,12)}')">
        </div>
        <div class="p-body">
          <h3 class="p-title">${p.name}</h3>
          <p class="p-sub">${catName}</p>
        </div>`;
      return card;
    }

    function render(list){
      const grid = $('#productGrid');
      const empty = $('#emptyState');
      grid.innerHTML = '';
      if(list.length === 0){
        grid.classList.add('hidden');
        empty.classList.remove('hidden');
        return;
      }
      empty.classList.add('hidden');
      grid.classList.remove('hidden');
      list.forEach(p => grid.appendChild(productCard(p)));
    }

    function filter(){
      const q = ($('#searchInput').value||'').toLowerCase();
      const sel = $('#catalogSelect').value;
      currentCatalog = sel;
      const list = PRODUCTS.filter(p => p.catalog===sel && p.name.toLowerCase().includes(q));
      render(list);
    }

    function onHashChange(){
      const hash = (location.hash||'').replace('#','');
      if(hash && hash !== currentCatalog && CATALOGS.some(c=>c.id===hash)){
        $('#catalogSelect').value = hash;
        filter();
      }
    }

    (async function init(){
      try{
        CATALOGS  = await loadJSON('data/catalogs.json');
        PRODUCTS  = await loadJSON('data/products.json');
        fillCatalogSelect();
        filter();
        $('#y').textContent = new Date().getFullYear();

        $('#catalogSelect').addEventListener('change', filter);
        $('#searchInput').addEventListener('input', filter);
        window.addEventListener('hashchange', onHashChange);
        // eriÅŸebilirlik
        $('#productGrid').setAttribute('aria-busy','false');
      }catch(e){
        console.error(e);
        alert('ÃœrÃ¼nler yÃ¼klenemedi.');
      }
    })();
  </script>
</body>
</html>
