<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VELİOĞLU GLOBAL DIŞ TİCARET LİMİTED ŞİRKETİ – Ürünler</title>

  <!-- fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- ortak stiller -->
  <link rel="stylesheet" href="common.css">
  <link rel="stylesheet" href="index.css">
  <!-- bu sayfanın stilleri -->
  <link rel="stylesheet" href="products.css">
</head>
<body>
  <!-- ==== DESKTOP NAV ==== -->
  <header class="desknav" role="banner" style="--accent:#54577D">
    <div class="desknav__wrap">
      <div class="desknav__inner">
        <div class="desknav__brand">
          <img class="desknav__logo" src="assets/logo-150.png" alt="VELİOĞLU GLOBAL DIŞ TİCARET LİMİTED ŞİRKETİ Logo" onerror="this.style.display='none'">
          <span class="desknav__title">VELİOĞLU GLOBAL DIŞ TİCARET LİMİTED ŞİRKETİ DAĞITIM</span>
        </div>
        <nav class="desknav__tabs" aria-label="Ana gezinme">
          <a class="desknav__tab" href="index.html">
            <span class="desknav__icon" aria-hidden="true">
              <svg viewBox="0 0 24 24"><path d="M10 6V5a2 2 0 0 1 2-2h0a2 2 0 0 1 2 2v1m-9 4h14m-15 0a2 2 0 0 1 2-2h11a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7Z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
            </span>
            <span>Markalar</span>
          </a>
          <a class="desknav__tab" href="products.html" aria-current="page">
            <span class="desknav__icon" aria-hidden="true">
              <svg viewBox="0 0 24 24"><path d="M4 7h7v7H4V7Zm9 0h7v7h-7V7ZM8 17h8v3H8v-3Z" fill="currentColor"/></svg>
            </span>
            <span>Ürünler</span>
          </a>
          <a class="desknav__tab" href="contact.html">
            <span class="desknav__icon" aria-hidden="true">
              <svg viewBox="0 0 24 24"><path d="M3 10h18M5 10v8m4-8v8m6-8v8m4-8v8M3 18h18M12 4 3 8h18L12 4Z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
            </span>
            <span>İletişim</span>
          </a>
        </nav>
      </div>
    </div>
  </header>

  <!-- ==== SAYFA İÇERİĞİ ==== -->
  <main class="container">
    <!-- üst bar: başlık + arama -->
    <div class="toolbar">
      <h2 id="pageTitle" class="page-title">Ürünler</h2>
      <label class="search">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
        <input id="q" type="search" placeholder="Ara" autocomplete="off" />
      </label>
    </div>

    <!-- gruplar burada -->
    <div id="groups" class="groups" aria-live="polite"></div>
  </main>

  <footer>
    <small>© <span id="y"></span> VELİOĞLU GLOBAL DIŞ TİCARET LİMİTED ŞİRKETİ • GitHub Pages</small>
  </footer>

  <!-- ==== ÜRÜN MODAL ==== -->
  <div id="pmBackdrop" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="pmTitle">
      <div class="modal-header">
        <h3 id="pmTitle" class="modal-title"></h3>
        <button id="pmClose" class="modal-close" aria-label="Kapat">✕</button>
      </div>
      <div class="modal-body">
        <img id="pmImg" alt="">
        <div class="kv">
          <span>Marka</span><b id="pmBrand">-</b>
        </div>
        <div class="kv">
          <span>Kategori</span><b id="pmCategory">-</b>
        </div>
        <div class="kv">
          <span>Paket</span><b id="pmPackage">-</b>
        </div>
        <div class="kv">
          <span>Koli adedi</span><b id="pmCase">-</b>
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn" id="pmClose2">Kapat</button>
      </div>
    </div>
  </div>

  <!-- ====== JS ====== -->
  <script>
    // aktif sekme emniyet
    (function(){
      const here = (location.pathname.split('/').pop() || 'products.html');
      document.querySelectorAll('.desknav__tab').forEach(t=>{
        const isHere = (t.getAttribute('href')||'') === here || (here==='' && t.getAttribute('href')==='products.html');
        t.setAttribute('aria-current', isHere?'page':'false');
      });
    })();

    const $  = (s, r=document) => r.querySelector(s);
    const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));

    // ---- Modal helpers ----
    const pmBackdrop = $('#pmBackdrop');
    const pmClose    = $('#pmClose');
    const pmClose2   = $('#pmClose2');

    function openModal(p){
      $('#pmTitle').textContent = p.name || '';
      $('#pmBrand').textContent = p.brand || '-';
      $('#pmCategory').textContent = p.category || '-';
      $('#pmPackage').textContent = p.package || '-';
      $('#pmCase').textContent = (p.case_qty ?? '-') + (p.case_qty ? ' adet' : '');
      const img = $('#pmImg');
      img.src = p.img || '';
      img.alt = p.name || '';
      img.onerror = () => {
        img.onerror = null;
        img.src = 'https://dummyimage.com/1200x1200/ffffff/111111&text=' + encodeURIComponent((p.name||'U')[0]);
      };
      pmBackdrop.classList.add('active');
      pmBackdrop.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
    }
    function closeModal(){
      pmBackdrop.classList.remove('active');
      pmBackdrop.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
    }
    pmClose.addEventListener('click', closeModal);
    pmClose2.addEventListener('click', closeModal);
    pmBackdrop.addEventListener('click', (e)=>{ if(e.target===pmBackdrop) closeModal(); });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal(); });

    // ---- UI helpers ----
    function makeCard(p){
      const a = document.createElement('a');
      a.className = 'product-card';
      a.href = '#';
      a.innerHTML = `
        <div class="thumb">
          <img src="${p.img || ''}" alt="${p.name}">
        </div>
        <div class="title" title="${p.name}">${(p.name||'').toUpperCase()}</div>`;
      const img = a.querySelector('img');
      img.onerror = () => {
        img.onerror = null;
        img.src = 'https://dummyimage.com/600x600/ffffff/111111&text=' + encodeURIComponent((p.name||'U')[0]);
      };
      a.addEventListener('click', (ev)=>{ ev.preventDefault(); openModal(p); });
      return a;
    }
    function makeGroup(label, items){
      const sec = document.createElement('section');
      sec.className = 'group';
      sec.innerHTML = `<h3 class="group-title">${label}</h3><div class="grid"></div>`;
      const grid = sec.querySelector('.grid');
      items.forEach(p => grid.appendChild(makeCard(p)));
      return sec;
    }
    function applyFilter(query){
      const q = query.trim().toLowerCase();
      $$('.group').forEach(g=>{
        let any = false;
        $$('.product-card', g).forEach(card=>{
          const t = card.querySelector('.title').textContent.toLowerCase();
          const ok = !q || t.includes(q);
          card.style.display = ok ? '' : 'none';
          if(ok) any = true;
        });
        g.style.display = any ? '' : 'none';
      });
    }
  </script>

  <!-- Firebase: ürünleri RTDB'den çek -->
  <script type="module">
    const firebaseConfig = {
      apiKey: "AIzaSyAKZslnECwA0wwMAhfHarE3wMLXoq7TV1k",
      authDomain: "veliogluglobal-86631.firebaseapp.com",
      databaseURL: "https://veliogluglobal-86631-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "veliogluglobal-86631",
      storageBucket: "veliogluglobal-86631.appspot.com",
      messagingSenderId: "643623290439",
      appId: "1:643623290439:web:a61c004610ceb9e1105362",
      measurementId: "G-D0WT8BV4C5"
    };

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);

    async function fetchProductsFromRTDB(){
      const snap = await get(child(ref(db), "products"));
      if(!snap.exists()) return [];
      const data = snap.val();
      return Object.entries(data).map(([id, p]) => ({
        id,
        name: p.name || "",
        catalog: p.catalog || "",
        img: p.img || null,
        brand: p.brand || null,
        category: p.category || null,
        package: p.package || null,
        case_qty: p.case_qty ?? null
      }));
    }

    (async function init(){
      try{
        // (İstersen brands.json kaldırılabilir; katalog adı için ürünlerdeki catalog kullanılıyor.)
        const products = await fetchProductsFromRTDB();

        // hash ile filtre: #brand=... veya #catalog=...
        const hash = (location.hash||'').slice(1);
        const params = new URLSearchParams(hash.replace(/^[?#]/,''));
        const brandFilter   = params.get('brand');
        const catalogFilter = params.get('catalog');

        // gruplandır (catalog’a göre)
        const groupsMap = new Map();
        products.forEach(p=>{
          if(brandFilter && (p.brand||'').toLowerCase() !== brandFilter.toLowerCase()) return;
          if(catalogFilter && p.catalog !== catalogFilter) return;
          const key = p.catalog || 'Diğer';
          if(!groupsMap.has(key)) groupsMap.set(key, []);
          groupsMap.get(key).push(p);
        });

        const wrap = document.getElementById('groups'); 
        wrap.innerHTML = '';
        const order = [...groupsMap.keys()].sort((a,b)=>a.localeCompare(b,'tr'));
        order.forEach(cat=>{
          const items = groupsMap.get(cat);
          if(!items || !items.length) return;
          const label = (cat || '').toString().toUpperCase();
          wrap.appendChild(makeGroup(label, items));
        });

        document.getElementById('q').addEventListener('input', (e)=> applyFilter(e.target.value));
        document.getElementById('y').textContent = new Date().getFullYear();
      }catch(e){
        console.error(e);
        alert('Ürünler yüklenemedi.');
      }
    })();
  </script>
</body>
</html>